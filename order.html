<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutch Republic • Order Online</title>
  <meta name="theme-color" content="#F1E9DC">
  <link rel="stylesheet" href="styles.css?v=1">
  <style>
    /* minimal chrome so it looks native to your site */
    body{margin:0;background:#fff;color:#111315;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    .bar{position:sticky;top:0;background:#F1E9DC;border-bottom:1px solid #e7e8ec;padding:10px 16px;z-index:10}
    .bar .brand{display:flex;align-items:center;gap:10px;max-width:1080px;margin:0 auto}
    .brand img{height:28px;width:auto}
    .brand a{margin-left:auto;text-decoration:none}
    .wrap{max-width:1080px;margin:0 auto;padding:10px 16px}
    .title{font-family:"Cinzel",serif;font-weight:900;text-align:center;margin:10px 0 0}

    .actions-row{max-width:1080px;margin:8px auto 0;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #111;font-weight:700;text-decoration:none;color:#111;background:#fff}
    .btn.primary{background:#10e3a1;border-color:#10e3a1}
    .btn.small{padding:8px 12px;font-weight:700}

    .leafly-embed{width:100%}
    .leafly-embed iframe{width:100%;height:calc(100vh - 140px);min-height:70vh;border:0;display:block}

    /* fallback */
    .fallback {
      max-width: 860px; margin: 18px auto; padding: 14px 16px;
      border: 1px dashed #c9c9c9; border-radius: 10px; background:#fafafa; display:none;
    }
    .fallback .actions { display:flex; gap:12px; flex-wrap:wrap; margin-top:10px; }
  </style>
</head>
<body>
  <div class="bar">
    <div class="brand">
      <img src="img/crest.svg" alt="Dutch Republic" onerror="this.style.display='none'">
      <strong>Dutch Republic</strong>
      <a href="index.html">Back to site</a>
    </div>
  </div>

  <div class="wrap">
    <h1 class="title">Shop Our Menu</h1>
  </div>

  <!-- Always-visible escape hatches (works even if the iframe crashes/blocks) -->
  <div class="actions-row" aria-label="Order actions">
    <a id="openLeaflyTop" class="btn primary" target="_blank" rel="noopener"
       href="https://www.leafly.com/dispensary-info/dutch-republic/menu">Open Full Menu</a>
    <a class="btn small" target="_blank" rel="noopener" href="https://www.leafly.com/bag">View Bag / Checkout</a>
  </div>

  <div class="leafly-embed">
    <iframe
      id="leaflyMenuIframe"
      title="Leafly Menu"
      src="https://www.leafly.com/dispensary-info/dutch-republic/menu"
      loading="eager"
      referrerpolicy="no-referrer-when-downgrade"
      allow="clipboard-read; clipboard-write">
    </iframe>
  </div>

  <!-- Fallback if the iframe is blocked or the Leafly app errors -->
  <div id="fallback" class="fallback" role="region" aria-live="polite" aria-label="Leafly menu fallback">
    <p>
      If the embedded menu doesn’t appear or shows an application error (common with ad-blockers or filtered DNS),
      open our menu directly on Leafly:
    </p>
    <div class="actions">
      <a id="openLeafly" class="btn primary" target="_blank" rel="noopener"
         href="https://www.leafly.com/dispensary-info/dutch-republic/menu">Open Menu on Leafly</a>
      <a class="btn" target="_blank" rel="noopener" href="https://www.leafly.com/bag">View Bag / Checkout</a>
    </div>
  </div>

  <script>
    (function(){
      const frame = document.getElementById('leaflyMenuIframe');
      const fallback = document.getElementById('fallback');
      const menuURL = 'https://www.leafly.com/dispensary-info/dutch-republic/menu';
      const bust = (u) => u + (u.includes('?') ? '&' : '?') + 'r=' + Date.now();

      // Add a tiny cache-buster so Leafly sees fresh session/auth
      frame.src = bust(menuURL);
      const topLink = document.getElementById('openLeaflyTop');
      const openLeafly = document.getElementById('openLeafly');
      if (topLink)   topLink.href = bust(menuURL);
      if (openLeafly) openLeafly.href = bust(menuURL);

      let loaded = false;
      frame.addEventListener('load', () => { loaded = true; });

      // Show fallback if the iframe never finishes loading (blocked)…
      setTimeout(() => {
        if (!loaded && fallback) fallback.style.display = 'block';
      }, 6000);

      // …and also show fallback after a while even if it "loaded" but Leafly crashed inside.
      // (We can't inspect cross-origin content; this is a pragmatic UX guard.)
      setTimeout(() => {
        if (fallback && fallback.style.display !== 'block') {
          fallback.style.display = 'block';
        }
      }, 12000);
    })();
  </script>
</body>
</html>
